FROM public.ecr.aws/docker/library/node:16.15.1-bullseye
RUN useradd -r -u 1001 -g root nonroot
COPY locale/ /locale/

WORKDIR /builder

COPY profile_management/tsconfig.json tsconfig.json

COPY profile_management/.yarn/ .yarn
COPY .npmrc .npmrc
COPY profile_management/package.json package.json
COPY profile_management/yarn.lock yarn.lock
COPY profile_management/.yarnrc .yarnrc

COPY profile_management/shared/ ./shared
COPY schemas/ /schemas

COPY profile_management/ui/tsconfig.json ui/tsconfig.json
COPY profile_management/ui/package.json ui/package.json

RUN yarn install

COPY profile_management/config.yml ./config.yml
COPY profile_management/ui/pages ./ui/pages

# https://github.com/vinissimus/next-translate/issues/421 (1)
RUN cd ui && find ./pages \( -type d -exec mkdir -p "/builder/ui/dummyPages/{}" \; -o -type f -exec touch "/builder/ui/dummyPages/{}" \; \)

EXPOSE 3000

CMD yarn workspace profile-management-ui dev